# –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ Node-RED

## –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏—Ç–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é –ø–æ 5 —à–∞–≥–∞–º, –≥–¥–µ –∫–∞–∂–¥—ã–π —à–∞–≥ –∏–º–µ–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `start` - –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- `speed` - —Å–∫–æ—Ä–æ—Å—Ç—å (–∏–Ω—Ç–µ—Ä–≤–∞–ª –≤ –º—Å –º–µ–∂–¥—É –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏)
- `step` - —à–∞–≥ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è
- `end` - –∫–æ–Ω–µ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- `pause` - –ø–∞—É–∑–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —à–∞–≥–∞

–ó–Ω–∞—á–µ–Ω–∏–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `ITERATION_VALUE` –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –≤–µ–±-–ø–∞–Ω–µ–ª–∏ —Å –≥—Ä–∞—Ñ–∏–∫–æ–º.

---

## –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

#### 1. **Race Condition –≤ —Ç–∞–π–º–µ—Ä–∞—Ö**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –£–∑–µ–ª "–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏—Ç–µ—Ä–∞—Ü–∏–∏" (id: `e08c2f4a04e1bd7d`)

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –§—É–Ω–∫—Ü–∏—è `scheduleNextTick()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ —á–µ—Ä–µ–∑ `setTimeout`
- –ü—Ä–∏ –±—ã—Å—Ç—Ä—ã—Ö –∫–æ–º–∞–Ω–¥–∞—Ö (start/stop/restart) –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–π–º–µ—Ä–æ–≤ –∞–∫—Ç–∏–≤–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `state.timer` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ `clearMainTimer()`, –Ω–æ –º–µ–∂–¥—É –æ—á–∏—Å—Ç–∫–æ–π –∏ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ –¥—Ä—É–≥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è:**
```javascript
// –°–æ–æ–±—â–µ–Ω–∏–µ 1: start
scheduleNextTick() // —Å–æ–∑–¥–∞–µ—Ç timer1
// –°–æ–æ–±—â–µ–Ω–∏–µ 2: stop (—á–µ—Ä–µ–∑ 1–º—Å)
clearAllTimers() // –æ—á–∏—â–∞–µ—Ç timer1
// timer1 —É–∂–µ –≤ –æ—á–µ—Ä–µ–¥–∏ —Å–æ–±—ã—Ç–∏–π, —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ —Å–æ–∑–¥–∞—Å—Ç timer2
```

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è.

---

#### 2. **–ù–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `state.control` –∏ `ITERATION_CONTROL`**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –£–∑–µ–ª "–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏—Ç–µ—Ä–∞—Ü–∏–∏"

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `state.control` —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —É–∑–ª–∞
- `ITERATION_CONTROL` —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–≥—É—Ç —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- –í —Ñ—É–Ω–∫—Ü–∏–∏ `broadcast()` —á–∏—Ç–∞–µ—Ç—Å—è `global.get('ITERATION_CONTROL')`, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `state.control` –≤ –ª–æ–≥–∏–∫–µ

**–ü—Ä–∏–º–µ—Ä:**
```javascript
// –í case 'restart':
state.control = 2;
global.set('ITERATION_CONTROL', 2);
broadcast('restart'); // –≤–Ω—É—Ç—Ä–∏ —á–∏—Ç–∞–µ—Ç global.get('ITERATION_CONTROL')
// –ú–µ–∂–¥—É —ç—Ç–∏–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏ –º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ –¥—Ä—É–≥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
```

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –∏–ª–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

---

#### 3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–ø—É—Å–∫–æ–º —à–∞–≥–æ–≤ –ø—Ä–∏ `step === 0`**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –§—É–Ω–∫—Ü–∏—è `advanceStep()` –∏ `scheduleNextTick()`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ `step === 0` —à–∞–≥ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `finishStep('skip')`
- –ù–æ –≤ changelog —É–∫–∞–∑–∞–Ω–æ: "–ü—Ä–æ–ø—É—Å–∫ —à–∞–≥–æ–≤ —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é 0 –Ω–µ –º–µ–Ω—è–µ—Ç ITERATION_VALUE"
- –û–¥–Ω–∞–∫–æ –ø—Ä–∏ `step === 0` –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Å–µ —Ä–∞–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `start` –≤ `advanceStep()`
- –≠—Ç–æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ –≤ –ª–æ–≥–∏–∫–µ

**–ö–æ–¥:**
```javascript
// –í advanceStep():
const startValue = Number(cfg.start);
setValue(Number.isFinite(startValue) ? startValue : 0); // ‚ùå –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –î–û –ø—Ä–æ–≤–µ—Ä–∫–∏ step === 0
broadcast(reason || 'stepStart');
if (speed <= 0 || stepValue === 0) {
    finishStep('skip');
    return;
}
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å `step === 0` –î–û —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏—è.

---

### ‚ö†Ô∏è –°–ï–†–¨–ï–ó–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

#### 4. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –≥–ª–æ–±–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –í—Å–µ —É–∑–ª—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í —Ñ—É–Ω–∫—Ü–∏–∏ "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö" –¥–µ–ª–∞–µ—Ç—Å—è 26 –≤—ã–∑–æ–≤–æ–≤ `global.get()`
- –í —Ñ—É–Ω–∫—Ü–∏–∏ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã" –¥–µ–ª–∞–µ—Ç—Å—è 10 –≤—ã–∑–æ–≤–æ–≤ `global.set()`
- –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ `global.get/set` - —ç—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ–π
- –ü—Ä–∏ —á–∞—Å—Ç—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö —ç—Ç–æ —Å–æ–∑–¥–∞–µ—Ç —É–∑–∫–æ–µ –º–µ—Å—Ç–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:** –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å batch-–æ–ø–µ—Ä–∞—Ü–∏–∏.

---

#### 5. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≥—Ä–∞–Ω–∏—Ü –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –£–∑–µ–ª "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —à–∞–≥–∞" (id: `64f7806605aa0f1c`)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —à–∞–≥–∞ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ `start` –∏ `end` –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `start > end` –ø—Ä–∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–º `step`, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–º—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é —à–∞–≥–∞
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Ä–∞–∑—É–º–Ω—ã–µ –ø—Ä–µ–¥–µ–ª—ã –∑–Ω–∞—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–µ —á–∏—Å–ª–∞)

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.

---

#### 6. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∫–æ–Ω–µ—á–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –§—É–Ω–∫—Ü–∏—è `scheduleNextTick()`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
let nextValue = state.value + increment;
if (increment > 0 && nextValue > cfgInner.end) {
    nextValue = cfgInner.end;
}
if (increment < 0 && nextValue < cfgInner.end) {
    nextValue = cfgInner.end;
}
setValue(nextValue);
// ...
if ((increment > 0 && nextValue >= cfgInner.end) || (increment < 0 && nextValue <= cfgInner.end)) {
    finishStep('completed');
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ï—Å–ª–∏ `step` –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π, –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç "–ø–µ—Ä–µ–ø—Ä—ã–≥–Ω—É—Ç—å" —á–µ—Ä–µ–∑ `end`
- –ü—Ä–∏ `increment < 0` –∏ `nextValue < cfgInner.end` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `cfgInner.end`, –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –µ—Å–ª–∏ `end` –±–æ–ª—å—à–µ —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Å–ª—É—á–∞–π, –∫–æ–≥–¥–∞ `start` –∏ `end` –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø–æ –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:**
- `start = 100`, `end = 50`, `step = -10`, —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `= 60`
- –ü–æ—Å–ª–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏: `nextValue = 50`, —É—Å–ª–æ–≤–∏–µ `nextValue <= end` (50 <= 50) = true, —à–∞–≥ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è
- –ù–æ –µ—Å–ª–∏ `step = -20`: `nextValue = 40`, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `end = 50`, –Ω–æ `40 < 50`, —É—Å–ª–æ–≤–∏–µ `40 <= 50` = true, —à–∞–≥ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

#### 7. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ —à–∞–≥–∞**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –§—É–Ω–∫—Ü–∏–∏ `advanceStep()` –∏ `scheduleNextTick()`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û–¥–∏–Ω–∞–∫–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `speed <= 0 || stepValue === 0` –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª–æ–≥–∏–∫–∏ –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª—è—Ç—å –æ–±–∞ –º–µ—Å—Ç–∞
- –†–∏—Å–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏

**–†–µ—à–µ–Ω–∏–µ:** –í—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é.

---

### üìä –ü–†–û–ë–õ–ï–ú–´ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

#### 8. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ broadcast –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ç–∏–∫–µ**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –§—É–Ω–∫—Ü–∏—è `scheduleNextTick()`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º —Ç–∏–∫–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `broadcast('tick')`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 2 —Å–æ–æ–±—â–µ–Ω–∏—è
- –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10–º—Å) —ç—Ç–æ 100 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É
- –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç UI
- –≠—Ç–æ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–∏—Å—Ç–µ–º—É –∏ –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ UI

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å throttling –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π 'tick' –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏—Ö —Ä–µ–∂–µ.

---

#### 9. **–ß—Ç–µ–Ω–∏–µ `flow.get('steps')` –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –£–∑–µ–ª "–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏—Ç–µ—Ä–∞—Ü–∏–∏"

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
const flowSteps = flow.get('steps') || [];
// ...
if (!Array.isArray(state.steps) || !state.steps.length) {
    state.steps = Array.isArray(flowSteps) ? flowSteps : [];
}
```

- `flow.get()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏, –¥–∞–∂–µ –µ—Å–ª–∏ `state.steps` —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω
- –≠—Ç–æ –∏–∑–±—ã—Ç–æ—á–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è

**–†–µ—à–µ–Ω–∏–µ:** –ß–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å.

---

#### 10. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ debounce –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –£–∑–µ–ª "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª"

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ —á–∞—Å—Ç—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—ã –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª
- –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—é —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏.

---

### üîß –ù–ï–¢–û–ß–ù–û–°–¢–ò –ò –£–õ–£–ß–®–ï–ù–ò–Ø

#### 11. **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –≤–µ—Ä—Å–∏–∏**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –£–∑–µ–ª "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞"

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `versionDisplay = "061120251656"` - —Ñ–æ—Ä–º–∞—Ç DDMMYYYYHHmm
- –ù–æ –≤ README —É–∫–∞–∑–∞–Ω —Ñ–æ—Ä–º–∞—Ç: –ø–µ—Ä–≤—ã–µ 2 —Ü–∏—Ñ—Ä—ã - —á–∏—Å–ª–æ, —Å–ª–µ–¥—É—é—â–∏–µ 2 - –º–µ—Å—è—Ü, 4 - –≥–æ–¥, 2 - —á–∞—Å, 2 - –º–∏–Ω—É—Ç—ã
- `061120251656` = 06 –Ω–æ—è–±—Ä—è 2025, 16:56 ‚úì (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- –ù–æ `versionFlow = "2025-11-06_1656"` - –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç
- `versionNumber = Number(versionDisplay)` = 61120251656 (—Ç–µ—Ä—è–µ—Ç—Å—è –≤–µ–¥—É—â–∏–π –Ω–æ–ª—å)

**–†–µ—à–µ–Ω–∏–µ:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç –≤–µ—Ä—Å–∏–π.

---

#### 12. **–•–∞—Ä–¥–∫–æ–¥ –≤–µ—Ä—Å–∏–∏ –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** 
- –£–∑–µ–ª "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞" (—Å—Ç—Ä–æ–∫–∞ 154)
- –£–∑–µ–ª "–û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ" (—Å—Ç—Ä–æ–∫–∞ 1327)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í–µ—Ä—Å–∏—è `"2025-11-06_1656"` –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–∞ –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏ –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö
- –†–∏—Å–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–µ—Ä—Å–∏–∏.

---

#### 13. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ñ–∞–π–ª–∞–º–∏**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –£–∑–ª—ã —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å—Ç—å `catch` —É–∑–µ–ª –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞, –Ω–æ –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∑–∞–ø–∏—Å–∏
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ª—É—á–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- –§–∞–π–ª –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–∏—Å–∞–Ω

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∑–∞–ø–∏—Å–∏.

---

#### 14. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π `state.value`**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –£–∑–µ–ª "–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏—Ç–µ—Ä–∞—Ü–∏–∏"

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
if (!Number.isFinite(state.value)) {
    const cfg = getStepConfig(state.currentStep);
    const startValue = cfg ? Number(cfg.start) : 0;
    setValue(Number.isFinite(startValue) ? startValue : 0);
}
```

- –≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
- –ï—Å–ª–∏ `state.value` —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –Ω–æ —à–∞–≥ –∏–∑–º–µ–Ω–∏–ª—Å—è, –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –Ω–∞—á–∞–ª—å–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é –ø—Ä–∏ —Å–º–µ–Ω–µ —à–∞–≥–∞

---

#### 15. **–õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ `finishStep()`**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –§—É–Ω–∫—Ü–∏—è `finishStep()`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
const delay = pause > 0 ? pause : 0;
state.pauseTimer = setTimeout(() => {
    // ...
    advanceStep(pause > 0 ? 'pauseComplete' : 'nextStep');
}, delay);
```

- –ï—Å–ª–∏ `pause === 0`, —Ç–∞–π–º–µ—Ä –≤—Å–µ —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å `delay = 0`
- `setTimeout(..., 0)` –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ç–∏–∫–µ event loop
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:** –ï—Å–ª–∏ `pause === 0`, –≤—ã–∑—ã–≤–∞—Ç—å `advanceStep()` –Ω–∞–ø—Ä—è–º—É—é –±–µ–∑ —Ç–∞–π–º–µ—Ä–∞.

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏**
- –†–∞–∑–±–∏—Ç—å –±–æ–ª—å—à–æ–π function node –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ–Ω—å—à–∏—Ö —É–∑–ª–æ–≤
- –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —É–∑–ª—ã
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —à–∞–≥–æ–≤

### 2. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (start/stop/restart)
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### 3. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**
- –î–æ–±–∞–≤–∏—Ç—å try-catch –±–ª–æ–∫–∏ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö
- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫–∏ –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### 4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å throttling –¥–ª—è —á–∞—Å—Ç—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π UI
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å batch-–æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### 5. **–£–ª—É—á—à–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ–∫—Ü–∏–π
- –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É race conditions

---

## –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:**
- üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ: 3
- ‚ö†Ô∏è –°–µ—Ä—å–µ–∑–Ω—ã–µ: 4  
- üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 3
- üîß –ù–µ—Ç–æ—á–Ω–æ—Å—Ç–∏: 5

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** –ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω, –Ω–æ –∏–º–µ–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –∏ –ª–æ–≥–∏–∫–æ–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö.
